-- View: public.doc_orders_t_tmp_products_list-- DROP VIEW public.doc_orders_t_tmp_products_list;CREATE OR REPLACE VIEW public.doc_orders_t_tmp_products_list AS 	SELECT t.login_id,		t.view_id,		t.line_number,		t.product_id,		products_descr(p.*, t.mes_length, t.mes_width, t.mes_height) AS product_descr,		t.mes_length,		t.mes_width,		t.mes_height,		t.volume,		t.weight,		t.quant_base_measure_unit AS quant,		round(t.quant_base_measure_unit, 0) AS quant_descr,		t.quant_confirmed_base_measure_unit,		t.price,		format_money(t.price) AS price_descr,		t.total,		format_money(t.total) AS total_descr,		t.total_pack,		t.pack_exists,		p.base_measure_unit_id AS measure_unit_id,		mu.name AS measure_unit_descr,		t.quant AS doc_quant,		t.measure_unit_id AS doc_measure_unit_id,		mu_doc.name AS doc_measure_unit_descr,		CASE			WHEN t.quant_confirmed_base_measure_unit > 0::numeric THEN				(SELECT					doc_order_calc_quant(t.product_id,							t.measure_unit_id,							t.mes_length,							t.mes_width,							t.mes_height,							t.quant_confirmed_base_measure_unit					) AS doc_order_calc_quant				)		ELSE 0::numeric		END AS quant_confirmed_measure_unit,		COALESCE(t.total_deliv, 0::numeric) AS total_deliv,				COALESCE(t.total_no_deliv, 0::numeric) AS total_no_deliv,		COALESCE(t.price_no_deliv, 0::numeric) AS price_no_deliv				/*		COALESCE(t.total, 0::numeric) - COALESCE(t.total_deliv, 0::numeric) AS total_no_deliv,		CASE			WHEN t.quant_base_measure_unit = 0::numeric THEN 0::numeric		ELSE round((COALESCE(t.total, 0::numeric) - COALESCE(t.total_deliv, 0::numeric)) / t.quant_base_measure_unit, 2)		END AS price_no_deliv		*/			FROM doc_orders_t_tmp_products t	LEFT JOIN products p ON p.id = t.product_id	LEFT JOIN measure_units mu ON mu.id = p.base_measure_unit_id	LEFT JOIN measure_units mu_doc ON mu_doc.id = t.measure_unit_id	ORDER BY t.line_number;ALTER TABLE public.doc_orders_t_tmp_products_list  OWNER TO polimerplast;